# simple-ical-server

> [!IMPORTANT]
> **AI Generation Disclaimer**: This entire project, including its code, configuration, and documentation, was generated by an AI assistant in response to user requirements.

A lightweight Python server built with **FastAPI** that dynamically generates and serves iCal (`.ics`) files from `.csv` data files.

## Features

- **Dynamic iCal Generation**: Automatically converts CSV files in the `data/` directory to standard iCal format.
- **Timezone Awareness**: Supports localized event times (default: `Europe/Berlin`) using `pytz`.
- **Modern Toolchain**: 
  - Managed with [uv](https://github.com/astral-sh/uv) for high-performance dependency management.
  - Reproducible development environments with [Nix Flakes](https://nixos.org/) and `uv2nix`.
  - Pinned to **Python 3.13**.
- **Docker Ready**: Includes a `Dockerfile` optimized for `uv`.
- **Health Checks**: `/healthz` and `/readyz` endpoints for monitoring.

## Getting Started

### Prerequisites

- [uv](https://github.com/astral-sh/uv)
- (Optional) [Nix](https://nixos.org/) for the development shell.

### Development with Nix

```bash
nix develop
# This will set up a virtualenv in .venv and provide uv, ruff, etc.
```

### Manual Setup with uv

```bash
uv sync
```

### Running the Server

```bash
uv run uvicorn src.main:app --reload
```

## API Endpoints

- `GET /`: Lists all available calendars (CSV files in `data/`).
- `GET /{name}.ics`: Serves the generated iCal file for the specified calendar.
- `GET /healthz`: Liveness check.
- `GET /readyz`: Readiness check.

## Data Format

CSV files should be placed in the `data/` directory. The filename becomes the calendar name.

**Format Example (`birthdays.csv`):**
```csv
date,time,duration,location,name,description,timezone
10.05.2024,09:00,30min,Workplace,Emma MÃ¼ller,Bring muffins for the team,Europe/Berlin
```

- `date`: `%d.%m.%Y`
- `time`: `%H:%M`
- `duration`: e.g., `30min`, `1h`
- `timezone`: Optional (defaults to `Europe/Berlin`)

## Testing

Run tests with `pytest`:

```bash
uv run pytest
```

## Docker

### Docker Compose (Recommended)

Run the server with the `data/` directory mounted as a volume:

```bash
docker compose up --build
```

This allows you to update CSV files in `data/` without rebuilding the image.

### Direct Docker Run

If you prefer to run the container directly, you must mount the volume manually:

```bash
docker build -t simple-ical-server .
docker run -p 8000:8000 -v $(pwd)/data:/app/data simple-ical-server
```
